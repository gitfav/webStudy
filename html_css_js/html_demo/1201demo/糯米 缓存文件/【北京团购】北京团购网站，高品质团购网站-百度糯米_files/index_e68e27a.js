var Slider=require("common:widget/ui/slider/slider.js"),Pager=require("common:widget/ui/pager/pager.js"),Template=require("common:widget/ui/template/template.js").template,Ceiling=require("common:widget/ui/ceiling/ceiling.js");$(function(){function e(){a(),r()}function t(){$("#j-ad-pointers").size()>0&&"none"==$("#j-ad-pointers").css("display")||require.async(["common:widget/ui/sliderbar/sliderbar.js"],function(e){new e({container:$("#j-rightAdContainer"),pageNumber:$("#j-ad-pointers a"),pageNumberHover:"hover",direction:"opacity",interval:5e3,callback:function(){this.pageNumber.hover(function(){$(this).trigger("click")})}})})}function i(){require.async("common:widget/ui/swiper/swiper.js",function(e){new e("#j-recomList .recom-list-box",{pagination:"#j-recomList .j-pointers",loop:!0,grabCursor:!0,paginationClickable:!0,slideActiveClass:"active",slideClass:"clearfix",autoplayDisableOnInteraction:!0,paginationActiveClass:"active",paginationElementClass:"pointer",autoplay:5e3,speed:600,wrapperClass:"sliders",onSlideNext:function(e){e.stopAutoplay(),e.startAutoplay()},onSlidePrev:function(e){e.stopAutoplay(),e.startAutoplay()},onSlideClick:function(e){e.stopAutoplay(),e.startAutoplay()}}),$(".j-previous-btn").hide(),$(".j-next-btn").hide()})}function n(){if(navigator.userAgent.match(/(iPad).*OS\s([\d_]+)/))return i(),!0;var e=new Slider("j-sliders",{autoScroll:{interval:5e3,enable:!0},fx:{duration:100,type:"slide"},exposureLog:!0});e.on("beforeslide",function(e){$(".j-pointers").children().removeClass("active").eq(e).addClass("active")}),e.start(),$("#j-recomList").on({mouseenter:function(){e.stop(),$(".j-previous-btn").show(),$(".j-next-btn").show()},mouseleave:function(){e.start(),$(".j-previous-btn").hide(),$(".j-next-btn").hide()}}),$(".j-previous-btn").on("click",function(){e.moveLeft()}),$(".j-next-btn").on("click",function(){e.moveRight()}),$(".j-pointers").on("click",".pointer",function(){e.slideTo($(this).index())}),$(".j-pointer").on("mouseenter",function(){e.slideTo($(this).index())})}function a(){o&&$.get(p,function(e){$("#j-recomList").html(e).fadeIn(),n()},"html"),$.getJSON(m,x.ajaxLoadHandler),$.getJSON(h+f,x.getRightADFirstHandler)}function r(){$("#j-areaFilterRow").on({mouseenter:x.areaFilterEnterHandler,mouseleave:x.areaFilterLeaveHandler}),l&&$(window).on("scroll",x.bodyScrollhandler)}var o=F.context("isHotCity")?!0:!1,l=F.context("needItemAjax")?!0:!1,s=F.context("ajaxViewCount")-1,c=F.context("paramSuffix"),d=!1,u=$("#j-BottomArea"),p="/pcindex/index/indexrecommendajax",m="/pcindex/index/indexhotajax",g="/pcindex/index/indexitemajax",h="/mis/ad/ad?adarea_id=",f=24,j=$("#j-rightAdFirst"),v="/pcindex/clearvst";c&&(g+="?"+c);var x={areaFilterEnterHandler:function(){$(this).addClass("hover")},areaFilterLeaveHandler:function(){$(this).removeClass("hover")},ajaxLoadHandler:function(e){function i(e,t,i){$("#"+e).html(Template(t,i))}if(0==e.errno){var n=e.data,a=n.sArr||{},r=n.hotRange,o=n.rightAd,l=n.hotTopic,s=n.rankItems,c=n.visitItems&&n.visitItems.detail?n.visitItems.detail:[];r&&i("j-hotRange","tplHotRange",{list:r});var d=5;o instanceof Array&&o.length>0&&(o.length>3&&(o.length=3),d-=o.length,i("j-rightAd","tplRightAd",{list:o}),t()),l instanceof Array&&l.length>0&&i("j-hotTopic","tplHotTopic",{list:l}),s instanceof Array&&s.length>0&&(s.length>d&&(s.length=d),i("j-hotRank","tplHotRank",{list:s,s:a.rankItem||""})),$("#j-recentViewed").size()>0&&c instanceof Array&&c.length>0&&(i("j-recentViewed","tplRecentViewed",{list:c,s:a.visitItem||""}),new Ceiling("j-recentviewed-ceilingbar",{}).init(),$(".j-recentViewed-clear").on({click:x.clearVisitedHandler}))}},bodyScrollhandler:function(){var e=$(window).scrollTop(),t=$(document.body).height(),i=t-1900;if(e>i){if(d)return;d=!0;var n=u.data("ajax-pn"),a={pn:++n};$.get(g,a,function(e){u.append(e),u.data("ajax-pn",n),s--,0>=s&&$(window).off("scroll",x.bodyScrollhandler),d=!1})}},getRightADFirstHandler:function(e){if(0===e.errno){var t=e.data[f],i="";for(var n in t){var a=t[n];i+='<a href="'+a.url+'" class="link" mon="element=adver_'+a.id+'&position=1" target="_blank"><img src="'+a.img+'" alt="'+a.title+'" class="ad-rt-img"></a>'}j.html(i)}},clearVisitedHandler:function(){$.post(v),$("#j-recentViewed").hide()}};e()});